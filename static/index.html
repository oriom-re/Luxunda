<!-- Load scripts in proper order to avoid conflicts -->
    <script src="graph.js" async></script>
    <script src="intention-component.js" async></script>
    <script src="chat-component.js" async></script>

    <script>
        // Wait for all scripts to load before initializing
        let scriptsLoaded = 0;
        const totalScripts = 3;

        function checkScriptsLoaded() {
            scriptsLoaded++;
            if (scriptsLoaded === totalScripts) {
                initializeApp();
            }
        }

        // Add load event listeners to scripts
        document.addEventListener('DOMContentLoaded', function() {
            const scripts = document.querySelectorAll('script[src]');
            scripts.forEach(script => {
                script.addEventListener('load', checkScriptsLoaded);
                script.addEventListener('error', (e) => {
                    console.error('Failed to load script:', e.target.src);
                });
            });
        });

        function initializeApp() {
            try {
                console.log('üöÄ Initializing LuxDB Graph...');

                // Check if all required classes are loaded
                if (typeof LuxOSGraph === 'undefined') {
                    console.error('‚ùå LuxOSGraph class not loaded');
                    return;
                }

                if (typeof IntentionComponent === 'undefined') {
                    console.error('‚ùå IntentionComponent class not loaded');
                    return;
                }

                if (typeof LuxChatComponent === 'undefined') {
                    console.error('‚ùå LuxChatComponent class not loaded');
                    return;
                }

                // Initialize components
                const graphManager = new LuxOSGraph();
                const intentionComponent = new IntentionComponent(graphManager);
                const luxChatComponent = new LuxChatComponent(graphManager);

                // Store global references for debugging
                window.luxOSUniverse = graphManager;
                window.intentionComponent = intentionComponent;
                window.luxChatComponent = luxChatComponent;

                // Add zoom controls event listeners
                const zoomIn = document.getElementById('zoomIn');
                const zoomOut = document.getElementById('zoomOut');
                const zoomReset = document.getElementById('zoomReset');
                const luxChat = document.getElementById('luxChat');

                if (zoomIn) zoomIn.addEventListener('click', () => graphManager.zoomIn());
                if (zoomOut) zoomOut.addEventListener('click', () => graphManager.zoomOut());
                if (zoomReset) zoomReset.addEventListener('click', () => graphManager.resetZoom());
                if (luxChat) luxChat.addEventListener('click', () => luxChatComponent.toggle());

                // Handle window resize
                window.addEventListener('resize', () => {
                    if (graphManager && graphManager.resizeGraph) {
                        graphManager.resizeGraph();
                    }
                });

                console.log('‚úÖ LuxDB Graph initialized successfully');
                console.log('üí´ Intention input available:', !!document.getElementById('intentionInput'));

            } catch (error) {
                console.error('‚ùå Error initializing LuxDB application:', error);

                // Show error in UI
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: #ff4444;
                    color: white;
                    padding: 20px;
                    border-radius: 10px;
                    z-index: 9999;
                    text-align: center;
                    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                `;
                errorDiv.innerHTML = `
                    <h3>‚ö†Ô∏è LuxDB Initialization Error</h3>
                    <p>${error.message}</p>
                    <button onclick="this.parentElement.remove()" style="
                        margin-top: 10px;
                        padding: 5px 15px;
                        background: white;
                        color: #ff4444;
                        border: none;
                        border-radius: 5px;
                        cursor: pointer;
                    ">Close</button>
                `;
                document.body.appendChild(errorDiv);
            }
        }
    </script>